<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Panel de Administraci√≥n</title>

<link rel="stylesheet" href="assets/css/style.css"> 
<style>
    /* Estilos base (puedes quitarlos si el assets/css/style.css ya los cubre bien) */
    body {
        margin: 0;
        padding: 0;
        background: #eef0f5; /* Fondo del body */
    }
    .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 15px 10px;
    }
    .back-btn {
        background: #444;
        margin-bottom: 15px;
    }

    /* MODAL (Necesario para la gesti√≥n de deudas) */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }
    .close-button {
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 24px;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
    }
</style>
</head>

<body>

<div class="container">

    <button class="back-btn" onclick="location.href='index.html'">‚üµ Regresar al Resumen</button>

    <h2>Panel de Administraci√≥n</h2>

    <div class="card">
        <h3>üí≥ Gesti√≥n de Deudas</h3>

        <table id="tabla-deudas" class="tabla-listado">
            <thead>
                <tr><th>Nombre</th><th>Monto Actual</th><th>Acci√≥n</th></tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <button onclick="mostrarFormularioDeuda()">Agregar/Abonar Deuda</button>
    </div>

    <div class="card">
        <h3>‚ûï Agregar Movimiento (Ingreso/Gasto)</h3>

        <label>Fecha:</label>
        <input type="date" id="fecha"> <label>Tipo:</label>
        <select id="tipo"> <option value="Ingreso">Ingreso</option>
            <option value="Gasto">Gasto</option>
        </select>

        <label>Categor√≠a:</label>
        <select id="categoria"></select> <label>Agregar nueva categor√≠a:</label>
        <input type="text" id="nuevaCategoria" placeholder="Ej. Gasolina extra"> <button onclick="agregarCategoria()">Agregar categor√≠a</button>

        <label>Descripci√≥n:</label>
        <input id="mov-desc" placeholder="Descripci√≥n opcional">

        <label>Monto:</label>
        <input type="number" id="monto" placeholder="0.00"> <button onclick="agregarMovimiento()">Guardar Movimiento</button>
    </div>

    <div class="card">
        <h3>üöó Configuraci√≥n de Kilometraje</h3>

        <label>Kilometraje Inicial:</label>
        <input type="number" id="kmInicial"> <label>Kilometraje Final:</label>
        <input type="number" id="kmFinal"> <label>Gasto Total (tanque, gas, etc):</label>
        <input type="number" id="gastoTotal"> <div class="section-title">Precio por km calculado:</div>
        <strong>$<span id="precioKm">0.00</span></strong> <button onclick="calcularKm()">Calcular y guardar</button>
        <button onclick="cargarConfiguracionKm()">Cargar configuraci√≥n</button>
    </div>

    <div class="card">
        <h2>Exportar / Importar</h2>
        <button onclick="exportarJSON()">Exportar datos</button>
        <textarea id="json-area"></textarea><br>

        <button onclick="importarJSON()">Importar</button>
    </div>
    
    <div class="card">
        <h2>Movimientos (todos)</h2>
        <table id="tabla-todos" class="tabla-listado"></table>
    </div>

</div>

<div id="deuda-modal" class="modal" style="display:none;">
    <div class="modal-content card">
        <h3>Gesti√≥n de Deuda</h3>
        <span class="close-button" onclick="cerrarFormularioDeuda()">&times;</span>
        
        <h4>Registrar Nueva Deuda</h4>
        <label>Nombre de la Deuda:</label>
        <input type="text" id="deuda-nombre" placeholder="Ej. Cr√©dito Coche">
        <label>Monto Inicial:</label>
        <input type="number" id="deuda-monto-inicial">
        <button onclick="registrarNuevaDeuda()">Registrar Deuda</button>

        <h4>Abonar a Deuda Existente</h4>
        <label>Seleccionar Deuda:</label>
        <select id="deuda-select-abono"></select>
        <label>Monto del Abono:</label>
        <input type="number" id="deuda-monto-abono">
        <button onclick="abonarADeuda()">Realizar Abono</button>

    </div>
</div>

<script src="assets/js/app.js"></script>
<script>
    // Funciones necesarias para el modal y tablas
    function mostrarFormularioDeuda() {
        if (typeof cargarSelectDeudas === 'function') cargarSelectDeudas();
        document.getElementById('deuda-modal').style.display = 'flex';
    }
    function cerrarFormularioDeuda() {
        document.getElementById('deuda-modal').style.display = 'none';
    }

    // Al cargar admin.html, cargar todas las listas
    window.onload = () => {
        // Ejecuta la l√≥gica de app.js (cargar categor√≠as, km)
        if (typeof window.onloadApp === 'function') window.onloadApp(); 
        
        // Cargamos tablas espec√≠ficas de admin
        if (typeof cargarTablaDeudas === 'function') cargarTablaDeudas();
        if (typeof cargarTablaTodos === 'function') cargarTablaTodos();
    };

    // Placeholders para funciones no implementadas en app.js
    function exportarJSON() { alert("La funcionalidad de Exportar JSON a√∫n no est√° implementada."); }
    function importarJSON() { alert("La funcionalidad de Importar JSON a√∫n no est√° implementada."); }
</script>
</body>
</html>
